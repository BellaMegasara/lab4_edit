<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bella's Fake Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Bella's Fake Store</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/ecommerce/chart.html">Chart</a>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Categories
            </a>
            <ul class="dropdown-menu" id="categoryDropdown"></ul>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" aria-disabled="true">Disabled</a>
          </li>
        </ul>
        <form class="d-flex" role="search">
          <input
            class="form-control me-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <div class="container">
      <div class="products"></div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetchCategories();
        fetchProducts("https://api.escuelajs.co/api/v1/products");
      });

      async function fetchCategories() {
        try {
          let response = await fetch(
            "https://api.escuelajs.co/api/v1/categories"
          );
          let categories = await response.json();

          // Limit the categories to the first 5
          let limitedCategories = categories.slice(0, 5);
          let categoryDropdown = document.getElementById("categoryDropdown");

          limitedCategories.forEach((category) => {
            categoryDropdown.innerHTML += `
                      <li><a class="dropdown-item" href="#" data-category-id="${category.id}">${category.name}</a></li>
                  `;
          });

          let dropdownItems =
            categoryDropdown.querySelectorAll(".dropdown-item");
          dropdownItems.forEach((item) => {
            item.addEventListener("click", function (event) {
              event.preventDefault();
              let categoryId = this.getAttribute("data-category-id");
              fetchProductsByCategory(categoryId);
            });
          });
        } catch (error) {
          console.error("Error fetching categories:", error);
        }
      }

      async function fetchProducts(url) {
        try {
          let response = await fetch(url);
          let productsData = await response.json();
          displayProducts(productsData);
        } catch (error) {
          console.error("Error fetching products:", error);
        }
      }

      function displayProducts(productsData) {
        let products = document.querySelector(".products");
        products.innerHTML = ""; 

        productsData.forEach((product) => {
          products.innerHTML += `
                  <div class="product">
                      <img src="${product.images[1]}" alt="${
            product.category.name
          }" class="product-img">
                      <div class="product-content">
                          <h2 class="product-title">${
                            product.title.length > 18
                              ? product.title.substring(0, 18).concat(" ...")
                              : product.title
                          }</h2>
                          <h4 class="product-category">${
                            product.category.name
                          }</h4>
                          <p class="product-description">${
                            product.description.length > 80
                              ? product.description
                                  .substring(0, 80)
                                  .concat(" ...more")
                              : product.description
                          }</p>
                          <div class="product-price-container">
                              <h3 class="product-price">${product.price}</h3>
                              <a href="#!" data-productId="${
                                product.id
                              }" class="add-to-cart">Add To Cart</a>
                          </div>
                      </div>
                  </div>
              `;
        });
      }

      function fetchProductsByCategory(categoryId) {
        fetchProducts(
          `https://api.escuelajs.co/api/v1/products/?categoryId=${categoryId}`
        );
      }
    </script>
  </body>
</html>
